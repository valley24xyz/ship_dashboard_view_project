<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incoming Ships</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="css/base.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quantico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">



    <!-- MAP -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://rawgit.com/bbecquet/Leaflet.RotatedMarker/master/leaflet.rotatedMarker.js"></script>
    <!--ESRI LEAFLET PLUGIN-->
    <script src="https://unpkg.com/esri-leaflet"></script>
    <style>
      html, body {
          display: grid;
          place-items: center;
      }
      .dashboard-header {
  display: flex;
  justify-content: left;  /* Align items on both sides */
  align-items: center;             /* Vertically align items */
  width: 100%;                     /* Ensure full width */
  margin-bottom: 10px;             /* Add some spacing below the headers */
}
h2 {
      font-family: 'Quantico';
      font-size: 16px;
      color: white;
      text-align: center;
      width: 100%;
      margin-top: 70px;
      margin-bottom: -40px;
    }

.header {
  font-size: 18px;
  font-weight: bold;
  width: 1350px;
}

.toggle-container {
  display: flex;
  margin-bottom: 8px;
  align-items: center;
  justify-content: flex-end;       /* Align the toggle to the right */
  width: 200px;                    /* Adjust as necessary for alignment */
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 120px;
  height: 40px;
  background-color: #f1f1f1;
  border-radius: 25px;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
}

.toggle-switch input {
  display: none;
}

.toggle-switch .labels {
  display: flex;
  justify-content: space-between;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;  /* This ensures the text is on top */
}

.toggle-switch .labels label {
  flex: 1;
  line-height: 40px;
  text-align: center;
  font-weight: bold;
  cursor: pointer;
  color: #666;
}

.toggle-switch input#air:checked ~ .labels label[for="air"],
.toggle-switch input#sea:checked ~ .labels label[for="sea"] {
  color: white;
}

.toggle-switch .slider {
  position: absolute;
  top: 0;
  left: 0;
  width: 50%;
  height: 100%;
  background-color: #333;
  border-radius: 25px;
  transition: 0.3s;
  z-index: 0;  /* Slider behind the text */
}

input#sea:checked ~ .slider {
  left: 50%;
}


  </style>

</head>
<body>
  <!-- Add a div to hold the map -->

<!-- Replace your current loading overlay with this one -->
 <h2 style="width: 1300px;">ships use AIS to make others aware of their positions, broadcasting location every few seconds, and information about the vessel every few minutes. view nearby vessels as they broadcast in realtime below. </h1>
<div class="button-container">
  <button class="back-button" onclick="window.location.href='index.html'">‚Üê back</button>
</div>
<div id="map" style="width: 1350px; height: 600px; margin-top: 75px; position: relative;">
  <!-- Updated loading overlay with two message states -->
  <div id="loadingOverlay" style="display: none; position: fixed; top: 25%; left: 50%; transform: translate(-50%, -50%); background: rgb(0, 0, 0, 0.8); padding: 30px; border-radius: 10px; text-align: center; z-index: 1000; min-width: 300px;">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
        <!-- Loading Spinner Container -->
        <div id="loadingSpinner" style="width: 50px; height: 50px;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
                <circle cx="25" cy="25" r="20" fill="none" stroke="#cccccc" stroke-width="5"/>
                <circle cx="25" cy="25" r="20" fill="none" stroke="#666666" stroke-width="5" stroke-dasharray="60 120">
                    <animateTransform
                        attributeName="transform"
                        attributeType="XML"
                        type="rotate"
                        from="0 25 25"
                        to="360 25 25"
                        dur="1s"
                        repeatCount="indefinite"/>
                </circle>
            </svg>
        </div>
        <!-- Initial Loading Message -->
        <div id="loadingMessage" style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
            <h2 style="font-size: 1.5rem; margin: 0; color: #ffffff;">Loading Ships...</h2>
            <p style="margin: 0; color: #cccccc;">Receiving AIS signals from ships in the area</p>
            <p style="font-size: 0.875rem; margin: 0; color: #888888;">This may take a few seconds as ships broadcast their positions</p>
        </div>
        <!-- No Data Message (initially hidden) -->
        <div id="noDataMessage" style="display: none; flex-direction: column; align-items: center; gap: 5px;">
            <h2 style="font-size: 1.5rem; margin: 0; color: #ffffff;">No AIS Data Detected</h2>
            <p style="margin: 0; color: #cccccc;">No ships found broadcasting AIS signals in this area</p>
            <p style="font-size: 0.875rem; margin: 0; color: #888888;">Try selecting a different area</p>
        </div>
    </div>
</div>
</div>

<!-- Add this style to your header or in a <style> tag -->
<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.back-button {
    font-family: 'Quantico', sans-serif;
    background-color: #1a1a1a;
    color: #ffffff;
    border: 2px solid #333333;
    padding: 8px 16px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    position: absolute;
    left: 20px;
    top: 20px;
}

.back-button:hover {
    background-color: #333333;
    border-color: #444444;
    box-shadow: 0 0 10px rgba(51, 51, 51, 0.5);
}

.back-button:active {
    transform: translateY(1px);
}
</style>
<!-- ============================================ -->
<!-- TOGGLE -->
<!-- ============================================ -->

<!-- ============================================ -->
    <!-- ============================================ -->
    <!-- ROW TEMPLATE -->
     <!-- Add a container for the split-flap board -->
     <div id="board" class="chartContainer splitflap" style="margin-left:50px">
      <div class="dashboard-header">
        <div class="header" style="width: 780px; text-align: left; font-family: 'Quantico'">Vessel Name</div>
        <div class="header" style="width: 380px; text-align: left; font-family: 'Quantico">Type</div>
        <div class="header" style="width: 200px; text-align: right; font-family: 'Quantico">Under Way</div>
        <!-- toggle switch  -->
        <!--
       <div class="toggle-container">
          <div class="toggle-switch">
            <input type="radio" id="air" name="toggle" checked onchange="toggleDashboard()">
            <input type="radio" id="sea" name="toggle" onchange="toggleDashboard()">

            <div class="labels">
              <label for="air">Air</label>
              <label for="sea">Sea</label>
          </div>

    <span class="slider"></span>
  </div>

        </div>
      
      </div>
      
    END CONTAINER -->
    <!-- ============================================ -->
    <!-- ROW TEMPLATE -->
    <script type="text/template" id="row_template">
      <div class="row">
        <div class="group flight"> <!-- ship number -->
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
        </div>
        <div class="group city"> <!-- type -->
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
          <div class="character"><span></span></div>
        </div>
        <div class="group status"> <!-- lights -->
          <div class="sA"></div>
          <div class="sB"></div>
        </div>
      </div>
    </script>
    <!-- END ROW TEMPLATE -->
    <!-- ============================================ -->

    <!-- ============================================ -->
    <!-- JS LIBRARIES -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js"
    ></script>
    <script type="text/javascript" src="js/split-flap.js"></script>

    <!-- ============================================ -->
    <!-- CUSTOM JS FOR THIS BOARD -->
    <script type="text/javascript" src="plugins/arrivals/custom.js"></script>
    <script type="text/javascript">
      // CUSTOMIZATION OPTIONS
      sf.options = {
        // REQUIRED
        plugin: 'arrivals', // Plugin to load
        container: $('#board'), // Where in the DOM to put the board
        template: $('#row_template'), // Where in the DOM to find the row template
        numRows: 12, // number of rows

        // OPTIONAL
//        sort: 'gate', // the column to sort by
//        order: 'asc', // the order to sort by
        maxResults: 12, // number of items to retrieve from service
        pageInterval: 5000, // delay between pages (ms)
        stagger: 1000 // delay between loading rows (ms)
      };

      $(document).ready(function() {
        sf.board.init(sf.options);
        sf.items.init(sf.options);
        sf.items.load(sf.options);
      });
      function getQueryParams() {
    var params = {};
    var queryString = window.location.search.slice(1);
    queryString.split('&').forEach(function (param) {
      var [key, value] = param.split('=');
      params[key] = decodeURIComponent(value);
    });
    return params;
  }

  // Use the query parameters and make them global
  var params = getQueryParams();
  var neLat = params.neLat;
  var neLng = params.neLng;
  var swLat = params.swLat;
  var swLng = params.swLng;

  // Log the parameters for debugging
  console.log('NorthEast Latitude:', neLat);
  console.log('NorthEast Longitude:', neLng);
  console.log('SouthWest Latitude:', swLat);
  console.log('SouthWest Longitude:', swLng);


// Make these variables available globally for custom.js 
window.boundingBox = { neLat, neLng, swLat, swLng };

  // Make these variables available globally for custom.js and app.js
  window.boundingBox = { neLat, neLng, swLat, swLng };

  function setBoundingBoxOnServer() {
    const { neLat, neLng, swLat, swLng } = window.boundingBox;
    
    if (!neLat || !neLng || !swLat || !swLng) {
        console.error('Invalid bounding box coordinates');
        return;
    }

    console.log('Setting bounding box with coordinates:', {
        neLat, neLng, swLat, swLng
    });

    // Send the bounding box to the server
    fetch(`/api/setBoundingBox?neLat=${neLat}&neLng=${neLng}&swLat=${swLat}&swLng=${swLng}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('Bounding box successfully updated on server:', data.boundingBox);
                
                // Wait a short moment before resubscribing
                setTimeout(() => {
                    fetch('/api/resubscribe')
                        .then(resubResponse => resubResponse.json())
                        .then(resubData => {
                            console.log('Resubscription response:', resubData);
                        })
                        .catch(error => {
                            console.error('Resubscription error:', error);
                        });
                }, 1000);
            } else {
                console.error('Failed to update bounding box on server:', data.error);
            }
        })
        .catch(error => {
            console.error('Error updating bounding box on server:', error);
        });
}
// Call this function after setting window.boundingBox
setBoundingBoxOnServer();

  </script>
  </body>
</html>